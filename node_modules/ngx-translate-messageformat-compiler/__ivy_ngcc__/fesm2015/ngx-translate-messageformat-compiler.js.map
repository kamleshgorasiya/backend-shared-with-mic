{"version":3,"file":"ngx-translate-messageformat-compiler.js","sources":["ngx-translate-messageformat-compiler/lib/message-format-config.ts","ngx-translate-messageformat-compiler/lib/translate-message-format-compiler.ts","ngx-translate-messageformat-compiler/lib/translate-message-format-debug-compiler.ts","ngx-translate-messageformat-compiler/public-api.ts","ngx-translate-messageformat-compiler/ngx-translate-messageformat-compiler.ts"],"names":[],"mappings":"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","sourcesContent":["import { InjectionToken } from \"@angular/core\";\n\nexport const MESSAGE_FORMAT_CONFIG = new InjectionToken<MessageFormatConfig>(\n  \"MESSAGE_FORMAT_CONFIG\"\n);\n\nexport interface MessageFormatConfig {\n  biDiSupport?: boolean;\n  formatters?: {\n    [name: string]: (val: any, lc: string, arg?: string) => string;\n  };\n  locales?: string | string[];\n  strictNumberSign?: boolean;\n  disablePluralKeyChecks?: boolean;\n}\n\nexport const defaultConfig: MessageFormatConfig = {\n  biDiSupport: false,\n  formatters: undefined,\n  locales: undefined,\n  strictNumberSign: false,\n  disablePluralKeyChecks: false,\n};\n","import { Inject, Injectable, Optional } from \"@angular/core\";\nimport { TranslateCompiler } from \"@ngx-translate/core\";\nimport * as MessageFormat from \"messageformat\";\nimport {\n  defaultConfig,\n  MessageFormatConfig,\n  MESSAGE_FORMAT_CONFIG,\n} from \"./message-format-config\";\n\n/**\n * This compiler expects ICU syntax and compiles the expressions with messageformat.js\n */\n@Injectable()\nexport class TranslateMessageFormatCompiler extends TranslateCompiler {\n  private messageFormat: MessageFormat;\n\n  constructor(\n    @Optional()\n    @Inject(MESSAGE_FORMAT_CONFIG)\n    config?: MessageFormatConfig\n  ) {\n    super();\n\n    const {\n      locales,\n      formatters,\n      biDiSupport,\n      strictNumberSign,\n      disablePluralKeyChecks,\n    } = {\n      ...defaultConfig,\n      ...config,\n    };\n\n    this.messageFormat = new MessageFormat(locales);\n\n    if (formatters) {\n      this.messageFormat.addFormatters(formatters);\n    }\n    if (biDiSupport) {\n      this.messageFormat.setBiDiSupport(biDiSupport);\n    }\n    if (strictNumberSign) {\n      this.messageFormat.setStrictNumberSign(strictNumberSign);\n    }\n    if (disablePluralKeyChecks) {\n      this.messageFormat.disablePluralKeyChecks();\n    }\n  }\n\n  public compile(value: string, lang: string): (params: any) => string {\n    return this.messageFormat.compile(value, lang);\n  }\n\n  public compileTranslations(translations: any, lang: string): any {\n    return this.messageFormat.compile(translations, lang);\n  }\n}\n","import { Injectable } from \"@angular/core\";\nimport { TranslateMessageFormatCompiler } from \"./translate-message-format-compiler\";\n\n/* tslint:disable-next-line no-console */\nconst log = (...message: string[]) => console.log(tag, ...message);\nconst tag = \"[TranslateMessageFormatCompiler]\";\n\n@Injectable()\nexport class TranslateMessageFormatDebugCompiler extends TranslateMessageFormatCompiler {\n  public compile(value: string, lang: string): (params: any) => string {\n    log(`COMPILE (${lang})`, value);\n    const interpolationFn = super.compile(value, lang);\n\n    return this.wrap(interpolationFn, value);\n  }\n\n  public compileTranslations(value: any, lang: string): any {\n    log(`COMPILE (${lang})`, value);\n    const { toString, ...interpolationFns } = super.compileTranslations(\n      value,\n      lang\n    );\n\n    return { toString, ...this.wrapRecursively(interpolationFns, value) };\n  }\n\n  private wrap(\n    fn: (params: any) => string,\n    reference: string\n  ): (params: any) => string {\n    return (params: any) => {\n      log(\"INTERPOLATE\", reference, params);\n      return fn(params);\n    };\n  }\n\n  private wrapRecursively(obj: any, referenceObj: any): any {\n    return Object.keys(obj).reduce((acc: any, key: string) => {\n      const value = obj[key];\n      const referenceValue = referenceObj[key];\n\n      return typeof value === \"function\"\n        ? { ...acc, [key]: this.wrap(value, referenceValue) }\n        : { ...acc, [key]: this.wrapRecursively(value, referenceValue) };\n    }, {});\n  }\n}\n","/*\n * Public API Surface of ngx-translate-messageformat-compiler\n */\n\nexport * from \"./lib/message-format-config\";\nexport * from \"./lib/translate-message-format-compiler\";\nexport * from \"./lib/translate-message-format-debug-compiler\";\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"]}